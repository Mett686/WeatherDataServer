<html>
    <head>
        <meta charset="UTF-8">
        <title>GZ-weatherAPI</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <link rel="stylesheet" href="" type="text/css"><script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
        <script type="text/javascript">
            google.charts.load('current', {'packages':['corechart']});
            google.charts.setOnLoadCallback(drawChart);
        
            let array; // Declare the variable outside the fetch block

            var weekAgo_ms = new Date() - 7 * 24 * 60 * 60 * 1000;
            var weekAgoString = new Date(weekAgo_ms).toISOString();
            console.log(weekAgoString);

            fetch(`http://knotkovi.tplinkdns.com:3000/array/${weekAgoString}/${new Date()}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    // Handle the JSON data
                    console.log(data);
                    array = data; // Assign data to the array variable here
                    drawChart(); // Call drawChart after fetching and processing the data
                })
                .catch(error => {
                    // Handle errors
                    console.error('There was a problem with the fetch operation:', error);
                });

            // Move the drawChart function definition here or make sure it's defined before calling drawChart
            function drawChart() {
                var data = google.visualization.arrayToDataTable(array);

                var options = {
                    title: 'Weather graph',
                    curveType: 'function',
                    legend: { position: 'bottom' }
                };

                var chart = new google.visualization.LineChart(document.getElementById('curve_chart'));

            chart.draw(data, options);
}
      </script>
    </head>
    <body>
        <div id="root" ></div>
        <p>Hello and welcome to GZ weather API</p>

        <p>Try chenking out <a href="http://knotkovi.tplinkdns.com:3000/data">http://knotkovi.tplinkdns.com:3000/data</a> for current values.</p>
        <p>Or try downloading for year <a href="http://knotkovi.tplinkdns.com:3000/data/2024.csv">2024</a>.</p>
        <div id="curve_chart" style="width: 1200px; height: 600px"></div>
    </body>
  </html>
  